<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ¿åœ°ç”¢å£ç¢‘è©•è«–ç”Ÿæˆå™¨ AI</title>
    
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- è¼‰å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- è¨­å®šæ¨£å¼èˆ‡å‹•ç•« -->
    <style>
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 20px;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        @keyframes slide-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slide-up 0.5s ease-out forwards;
        }
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans selection:bg-blue-100">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState } from 'https://esm.sh/react@18.2.0?dev';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client?dev';
        import { 
            Sparkles, Copy, Home, CheckCircle, RefreshCw, AlertCircle, Tag, Users, Quote, 
            Search, Globe, ShieldCheck, AlertTriangle, Wand2, Share2, MessageSquare, 
            Loader2, Eye, ThumbsDown, CheckCheck, HardHat 
        } from 'https://esm.sh/lucide-react@0.300.0?dev';

        const RealEstateReviewGen = () => {
            // âš ï¸ è«‹åœ¨é€™è£¡å¡«å…¥æ‚¨çš„ Google Gemini API Key
            const apiKey = "AIzaSyCnBqzVDOsP-69yDTOrWTSfFM5hG8KBLJM"; 

            const [searchQuery, setSearchQuery] = useState('');
            const [isGenericMode, setIsGenericMode] = useState(false);
            const [projectStatus, setProjectStatus] = useState('é å”®');
            const [features, setFeatures] = useState('');
            const [selectedRoles, setSelectedRoles] = useState([]);
            const [reviews, setReviews] = useState([]);
            const [isGenerating, setIsGenerating] = useState(false);
            const [error, setError] = useState('');
            const [copyStatus, setCopyStatus] = useState(null);
            const [activeCategory, setActiveCategory] = useState("äº¤é€šåœ°æ®µ");
            const [generationMode, setGenerationMode] = useState(null);
            
            const [rewritingIndex, setRewritingIndex] = useState(null);
            const [analyzingIndex, setAnalyzingIndex] = useState(null);
            const [isAnalyzingAll, setIsAnalyzingAll] = useState(false);
            const [critiques, setCritiques] = useState({});

            const statusOptions = [
                { id: 'é å”®', label: 'é å”®å±‹', desc: 'å¼·èª¿æ¥å¾…ä¸­å¿ƒé«”é©—ã€æœªä¾†é¡˜æ™¯' },
                { id: 'çµæ§‹é«”', label: 'çµæ§‹é«”', desc: 'å¼·èª¿å·¥ç¨‹é€²åº¦ã€çœ‹çš„åˆ°å»ºç¯‰' },
                { id: 'æˆå±‹', label: 'æˆå±‹', desc: 'å¼·èª¿å¯¦éš›æ¡å…‰ã€å…¬è¨­ã€å¯ç«‹å³å…¥ä½' }
            ];

            const cleanJson = (text) => {
                if (!text) return text;
                let cleaned = text.replace(/```json\n?|```/g, '').trim();
                const firstBracket = cleaned.indexOf('[');
                const lastBracket = cleaned.lastIndexOf(']');
                if (firstBracket !== -1 && lastBracket !== -1) {
                return cleaned.substring(firstBracket, lastBracket + 1);
                }
                return cleaned;
            };

            const rolesList = ["é¦–è³¼æ—", "æ–°å©šå¤«å¦»", "æ›å±‹æ—", "åœ¨åœ°é„°å±…", "æŠ•è³‡å®¢", "é€€ä¼‘æ—", "æ³¨é‡ç´°ç¯€è€…", "è·¯éçœ‹å±‹"];

            const tagCategories = [
                {
                name: "äº¤é€šåœ°æ®µ",
                tags: ["è¿‘æ·é‹ç«™", "ä¸Šäº¤æµé“å¿«", "é›™éµå…±æ§‹", "é–€å£æœ‰å…¬è»Š", "äº¤é€šæ¨ç´", "èµ°è·¯åˆ°è»Šç«™", "é€šå‹¤æ–¹ä¾¿"]
                },
                {
                name: "ç”Ÿæ´»æ©Ÿèƒ½",
                tags: ["æ˜æ˜Ÿå­¸å€", "ç”Ÿæ´»æ©Ÿèƒ½ä½³", "å®‰éœå··å¼„", "å…¬åœ’ç¬¬ä¸€æ’", "è¿‘ç™¾è²¨å•†åœˆ", "å‚³çµ±å¸‚å ´ä¾¿åˆ©", "é‡åŠƒå€æ½›åŠ›", "ä¾¿åˆ©å•†åº—å¤š"]
                },
                {
                name: "æ ¼å±€å±‹æ³",
                tags: ["æ ¼å±€æ–¹æ­£", "æ¡å…‰é€šé¢¨ä½³", "ç„¡æ•µæ™¯è§€", "å¤§é™½å°", "è¡›æµ´é–‹çª—", "é«˜åªæ•ˆ", "å‹•ç·šæµæš¢", "æŒ‘é«˜ç©ºé–“", "æ¨‘æŸ±å¤–æ¨"]
                },
                {
                name: "ç¤¾å€è¦åŠƒ",
                tags: ["çŸ¥åå»ºå•†", "å…¬è¨­è±å¯Œ", "æˆ¶æ•¸å–®ç´”", "ç‰©æ¥­ç®¡ç†å¥½", "æ–½å·¥å“è³ªä½³", "é›¶åº—é¢", "å¤–è§€æ°£æ´¾", "åƒåœ¾è™•ç†æ–¹ä¾¿"]
                },
                {
                name: "éŠ·å”®åƒ¹æ ¼",
                tags: ["ç¸½åƒ¹è¦ªæ°‘", "é©åˆé¦–è³¼", "ä»£éŠ·è¬›è§£è©³ç´°", "CPå€¼é«˜", "å…·å¢å€¼æ½›åŠ›", "ä¸äºŒåƒ¹éŠ·å”®", "ä½è‡ªå‚™æ¬¾", "å„ªæƒ æ–¹æ¡ˆ"]
                }
            ];

            const addTag = (tag) => {
                setFeatures(prev => prev ? `${prev}ã€${tag}` : tag);
            };

            const toggleRole = (role) => {
                setSelectedRoles(prev => 
                prev.includes(role) 
                    ? prev.filter(r => r !== role)
                    : [...prev, role]
                );
            };

            const runCritique = async (reviewContent) => {
                if (!apiKey) {
                    setError('è«‹å…ˆåœ¨ç¨‹å¼ç¢¼ä¸­è¨­å®š API Key');
                    return null;
                }
                const prompt = `
                ä½ æ˜¯ä¸€ä½éå¸¸åš´æ ¼çš„ã€æˆ¿åœ°ç”¢ä»£éŠ·å°ˆæ¡ˆç¶“ç†ã€‘ã€‚
                è«‹å¯©è¦–ä»¥ä¸‹é€™å‰‡å‰›ç”Ÿæˆçš„ Google è©•è«–ï¼Œåˆ¤æ–·å®ƒæ˜¯å¦å°å»ºæ¡ˆæœ‰ã€Œæ‰£åˆ†ã€é¢¨éšªã€‚
                å»ºæ¡ˆç›®å‰éšæ®µç‚ºï¼š${projectStatus}

                è©•è«–å…§å®¹ï¼š
                "${reviewContent}"

                è«‹åˆ†æä»¥ä¸‹å¹¾é»ï¼š
                1. **éšæ®µåˆç†æ€§**ï¼šå…§å®¹æ˜¯å¦ç¬¦åˆã€Œ${projectStatus}ã€çš„ç‰¹æ€§ï¼Ÿ(ä¾‹å¦‚é å”®å±‹å»èªªå·²ç¶“ä½é€²å»ï¼Œå°±æ˜¯ä¸åˆç†)ã€‚
                2. **æ“¬çœŸåº¦æª¢æ ¸**ï¼šæ˜¯å¦å¤ªåƒ AI å¯«çš„ï¼Ÿç”¨è©æ˜¯å¦å¤ªéçŸ¯æƒ…ï¼Ÿ
                3. **åæ•ˆæœæª¢æ ¸**ï¼šæ˜¯å¦ç„¡æ„é–“æš´éœ²äº†ç¼ºé»ï¼Ÿ
                4. **é¢¨éšªè©•ä¼°**ï¼šçµ¦äºˆé¢¨éšªç­‰ç´šï¼ˆğŸŸ¢ å®‰å…¨ / ğŸŸ¡ éœ€æ³¨æ„ / ğŸ”´ å±éšªï¼‰ã€‚

                è«‹ç›´æ¥å›å‚³ç°¡çŸ­çš„åˆ†æçµæœã€‚æ ¼å¼å¦‚ä¸‹ï¼š
                ã€é¢¨éšªç­‰ç´šï¼šğŸŸ¢ å®‰å…¨ / ğŸŸ¡ éœ€æ³¨æ„ / ğŸ”´ å±éšªã€‘
                è©•è«–åˆ†æï¼š(ä½ çš„åˆ†æå…§å®¹)
                å»ºè­°ä¿®æ”¹ï¼š(ä¸€å¥è©±å»ºè­°)
                `;

                try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }),
                    }
                );

                if (!response.ok) throw new Error('Critique failed');
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text;
                } catch (err) {
                console.error("Critique error:", err);
                return null;
                }
            };

            const handleCritique = async (index) => {
                setAnalyzingIndex(index);
                const result = await runCritique(reviews[index].content);
                if (result) {
                setCritiques(prev => ({ ...prev, [index]: result }));
                }
                setAnalyzingIndex(null);
            };

            const handleCritiqueAll = async () => {
                if (reviews.length === 0) return;
                
                setIsAnalyzingAll(true);
                setCritiques({});
                
                const promises = reviews.map(async (review, index) => {
                const result = await runCritique(review.content);
                if (result) {
                    setCritiques(prev => ({ ...prev, [index]: result }));
                }
                });

                await Promise.allSettled(promises);
                setIsAnalyzingAll(false);
            };

            const handleRewrite = async (index, mode) => {
                if (!apiKey) {
                    setError('è«‹å…ˆåœ¨ç¨‹å¼ç¢¼ä¸­è¨­å®š API Key');
                    return;
                }
                setRewritingIndex(index);
                const targetReview = reviews[index];

                let instruction = "";
                if (mode === 'shorter') {
                instruction = "è«‹å°‡ä»¥ä¸‹æˆ¿åœ°ç”¢è©•è«–æ”¹å¯«å¾—æ›´ã€Œç°¡çŸ­æœ‰åŠ›ã€ï¼Œå»é™¤å†—è¨€è´…å­—ï¼Œä½†ä¿ç•™æ ¸å¿ƒå„ªå‹¢ï¼Œå­—æ•¸æ¸›å°‘ç´„ 30%ã€‚";
                } else if (mode === 'casual') {
                instruction = "è«‹å°‡ä»¥ä¸‹æˆ¿åœ°ç”¢è©•è«–æ”¹å¯«å¾—æ›´ã€Œç”Ÿæ´»åŒ–ã€å£èªåŒ–ã€ï¼Œåƒæ˜¯åœ¨ PTT æˆ– Dcard çš„çœŸå¯¦ç•™è¨€ï¼Œèªæ°£éš¨æ€§ä¸€é»ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å°ç£å¸¸è¦‹çš„èªåŠ©è©ï¼Œä¸è¦å¤ªåƒä½œæ–‡ã€‚";
                } else if (mode === 'social') {
                instruction = "è«‹å°‡ä»¥ä¸‹æˆ¿åœ°ç”¢è©•è«–æ”¹å¯«æˆä¸€ç¯‡é©åˆç™¼å¸ƒåœ¨ Facebook æˆ– Instagram çš„ã€Œç¤¾ç¾¤è²¼æ–‡ã€ã€‚è«‹åŠ å…¥è±å¯Œçš„è¡¨æƒ…ç¬¦è™Ÿ (Emojis)ï¼Œä¸¦åœ¨æ–‡æœ«åŠ ä¸Š 3-5 å€‹ç›¸é—œçš„ç†±é–€ Hashtagsã€‚";
                }

                const prompt = `
                ${instruction}
                åŸå§‹è©•è«–å…§å®¹ï¼š
                "${targetReview.content}"
                è«‹ç›´æ¥å›å‚³æ”¹å¯«å¾Œçš„å…§å®¹ï¼Œä¸è¦åŒ…å«ä»»ä½•è§£é‡‹æˆ–é¡å¤–æ–‡å­—ã€‚`;

                try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }),
                    }
                );

                if (!response.ok) throw new Error('Rewrite failed');
                const data = await response.json();
                const newContent = data.candidates?.[0]?.content?.parts?.[0]?.text;

                if (newContent) {
                    const updatedReviews = [...reviews];
                    updatedReviews[index] = { ...updatedReviews[index], content: newContent.trim() };
                    setReviews(updatedReviews);
                    setCritiques(prev => {
                    const newCritiques = { ...prev };
                    delete newCritiques[index];
                    return newCritiques;
                    });
                }
                } catch (err) {
                console.error("Rewrite error:", err);
                } finally {
                setRewritingIndex(null);
                }
            };

            const generateReviews = async () => {
                if (!apiKey) {
                    setError('è«‹å…ˆåœ¨ç¨‹å¼ç¢¼ä¸­è¨­å®š API Key');
                    return;
                }
                if (!features.trim() && !searchQuery.trim() && !isGenericMode) {
                setError('è«‹è¼¸å…¥å»ºæ¡ˆåç¨±ï¼Œæˆ–æ˜¯å‹¾é¸ã€Œä¸æŒ‡å®šç‰¹å®šå»ºæ¡ˆã€');
                return;
                }

                setIsGenerating(true);
                setError('');
                setReviews([]);
                setCritiques({});
                setGenerationMode(null);

                let roleInstruction = "è«‹æ¨¡æ“¬ä¸åŒé¡å‹çš„çœŸå¯¦äººé¡ï¼ˆä¾‹å¦‚ï¼šå‰›çµå©šçš„å°å¤«å¦»ã€è·¯éçš„é„°å±…...ï¼‰ã€‚";
                if (selectedRoles.length > 0) {
                roleInstruction = `è«‹å‹™å¿…å„ªå…ˆåŒ…å«ä»¥ä¸‹è§’è‰²çš„è©•è«–è¦–è§’ï¼š${selectedRoles.join('ã€')}ã€‚è‹¥é¸å–è§’è‰²å°‘æ–¼ 5 å€‹ï¼Œå…¶é¤˜è«‹éš¨æ©Ÿæ¨¡æ“¬å…¶ä»–çœŸå¯¦å®¢ç¾¤ã€‚`;
                }

                // å»ºæ¡ˆéšæ®µçš„æŒ‡ç¤ºè©
                let statusInstruction = "";
                if (projectStatus === 'é å”®') {
                statusInstruction = "å»ºæ¡ˆéšæ®µç‚ºã€é å”®å±‹ã€‘ã€‚è©•è«–é‡é»æ‡‰æ”¾åœ¨ï¼šæ¥å¾…ä¸­å¿ƒçš„é«”é©—ã€ä»£éŠ·äººå“¡çš„å°ˆæ¥­åº¦ã€æ¨£å“å±‹çš„è¦åŠƒã€ä»˜æ¬¾æ–¹å¼è¼•é¬†ã€å°æœªä¾†ç™¼å±•çš„æœŸå¾…ã€‚åˆ‡å‹¿å¯«ã€Œå·²ç¶“ä½é€²å»ã€æˆ–ã€Œå¯¦éš›æ¡å…‰å¦‚ä½•ã€ã€‚";
                } else if (projectStatus === 'çµæ§‹é«”') {
                statusInstruction = "å»ºæ¡ˆéšæ®µç‚ºã€çµæ§‹é«”ä¸­ã€‘ã€‚è©•è«–é‡é»æ‡‰æ”¾åœ¨ï¼šå·¥ç¨‹é€²åº¦çœ‹å¾—åˆ°ã€å»ºç¯‰å¤–è§€é€æ¼¸æˆå½¢ã€å‘¨é‚Šç’°å¢ƒçš„å¯¦éš›æ„Ÿå—ã€æœŸå¾…äº¤å±‹çš„å¿ƒæƒ…ã€‚";
                } else if (projectStatus === 'æˆå±‹') {
                statusInstruction = "å»ºæ¡ˆéšæ®µç‚ºã€æ–°æˆå±‹/æˆå±‹ã€‘ã€‚è©•è«–é‡é»æ‡‰æ”¾åœ¨ï¼šå¯¦éš›çœ‹å±‹çš„ç©ºé–“æ„Ÿã€æ¡å…‰é€šé¢¨çš„çœŸå¯¦é«”é©—ã€å…¬è¨­çš„è³ªæ„Ÿã€éš¨æ™‚å¯å…¥ä½çš„ä¾¿åˆ©æ€§ã€æ–½å·¥ç´°ç¯€å“è³ªã€‚";
                }

                const genericSystemPrompt = `ä½ æ˜¯ä¸€ä½ç†Ÿæ‚‰å°ç£æˆ¿åœ°ç”¢å¸‚å ´çš„å£ç¢‘è¡ŒéŠ·å°ˆå®¶ã€‚
                ä½ æ­£åœ¨æ’°å¯«ä¸€çµ„ã€Œé€šç”¨å‹ã€çš„æˆ¿åœ°ç”¢å¥½è©•ï¼Œé€™çµ„è©•è«–å°‡è¢«ç”¨æ–¼å¤šå€‹ä¸åŒçš„å»ºæ¡ˆã€‚

                ã€æœ€é«˜æŒ‡å°åŸå‰‡ï¼šé€šç”¨æ€§èˆ‡çœŸå¯¦æ„Ÿã€‘
                1. **éšæ®µæ€§æº–ç¢º**ï¼š${statusInstruction}
                2. **æ¨¡ç³ŠåŒ–åœ°é»**ï¼šå› ç‚ºä¸æŒ‡å®šå»ºæ¡ˆï¼Œä½ **çµ•å°ç¦æ­¢**æåŠä»»ä½•å…·é«”çš„è·¯åã€æ·é‹ç«™åã€è¡Œæ”¿å€æˆ–åœ°æ¨™ã€‚
                3. **å°ˆæ³¨ç‰¹è‰²**ï¼šè«‹å®Œå…¨ä¾è³´ä½¿ç”¨è€…æä¾›çš„ç‰¹è‰²ï¼ˆ${features}ï¼‰ä¾†é€²è¡Œæ“´å¯«ã€‚
                4. **æ“¬çœŸåº¦**ï¼šèªæ°£è¦åƒçœŸçš„ä½æˆ¶æˆ–çœ‹å±‹å®¢ã€‚
                5. **è§’è‰²èˆ‡èªæ°£**ï¼š${roleInstruction}ã€‚
                6. **æ ¼å¼**ï¼šè«‹å‹™å¿…è¼¸å‡ºã€Œç´”ç²¹çš„ JSON Array å­—ä¸²ã€ã€‚æ ¼å¼ï¼š[{ "role": "...", "stars": 4, "content": "..." }]ã€‚`;

                const searchSystemPrompt = `ä½ æ˜¯ä¸€ä½ç†Ÿæ‚‰å°ç£æˆ¿åœ°ç”¢å¸‚å ´çš„å£ç¢‘è¡ŒéŠ·å°ˆå®¶ã€‚
                ä½ çš„ä»»å‹™æ˜¯ç‚ºå»ºæ¡ˆï¼ˆ${searchQuery}ï¼‰æ’°å¯« Google Maps è©•è«–ã€‚

                ã€æœ€é«˜æŒ‡å°åŸå‰‡ï¼šç²¾æº–èˆ‡çœŸå¯¦ã€‘
                1. **éšæ®µæ€§æº–ç¢º**ï¼š${statusInstruction}
                2. **ç¶å®šçœŸå¯¦è³‡è¨Š**ï¼šä½ **å¿…é ˆ**é€é Google Search ç²å–å»ºæ¡ˆçœŸå¯¦è³‡è¨Šï¼ˆè¡Œæ”¿å€ã€è·¯åã€é™„è¿‘åœ°æ¨™ï¼‰ã€‚
                3. **èåˆå„ªå‹¢**ï¼šå°‡ä½¿ç”¨è€…å¼·èª¿çš„å„ªå‹¢ï¼ˆ${features}ï¼‰èˆ‡æœå°‹åˆ°çš„çœŸå¯¦è³‡è¨Šçµåˆã€‚
                4. **é˜²å‘†æ©Ÿåˆ¶**ï¼šå¦‚æœæœå°‹çµæœé¡¯ç¤ºè©²å»ºæ¡ˆä½æ–¼å—éƒ¨ï¼Œä½†ä½¿ç”¨è€…çš„æè¿°çœ‹ä¼¼æ˜¯åŒ—éƒ¨å»ºæ¡ˆï¼Œè«‹ä»¥æœå°‹çµæœç‚ºæº–ã€‚
                5. **è§’è‰²èˆ‡èªæ°£**ï¼š${roleInstruction} èªæ°£è¦åƒçœŸäººã€‚
                6. **æ ¼å¼**ï¼šè«‹å‹™å¿…è¼¸å‡ºã€Œç´”ç²¹çš„ JSON Array å­—ä¸²ã€ï¼Œä¸è¦ Markdownã€‚æ ¼å¼ï¼š[{ "role": "...", "stars": 4, "content": "..." }]ã€‚`;

                const safeSystemPrompt = `ä½ æ˜¯ä¸€ä½ç†Ÿæ‚‰å°ç£æˆ¿åœ°ç”¢å¸‚å ´çš„å£ç¢‘è¡ŒéŠ·å°ˆå®¶ã€‚
                ä½ æ­£åœ¨ç‚ºå»ºæ¡ˆï¼ˆ${searchQuery}ï¼‰æ’°å¯«è©•è«–ã€‚
                
                ã€æœ€é«˜æŒ‡å°åŸå‰‡ï¼šå®‰å…¨è‡³ä¸Šï¼Œç¦æ­¢å¹»è¦ºã€‘
                1. **éšæ®µæ€§æº–ç¢º**ï¼š${statusInstruction}
                2. **ç¾æ³èªªæ˜**ï¼šç„¡æ³•é€£ç·šå–å¾—ç¢ºåˆ‡è³‡æ–™ï¼Œä½ **çµ•å°ç¦æ­¢**ç·¨é€ ä»»ä½•è·¯åæˆ–åœ°æ¨™ã€‚
                3. **å°ˆæ³¨ç‰¹è‰²**ï¼šè«‹å®Œå…¨ä¾è³´ä½¿ç”¨è€…æä¾›çš„ç‰¹è‰²ï¼ˆ${features}ï¼‰ä¾†é€²è¡Œæ“´å¯«ã€‚
                4. **è§’è‰²èˆ‡èªæ°£**ï¼š${roleInstruction}ã€‚
                5. **æ ¼å¼**ï¼šå›å‚³ JSON Arrayã€‚`;

                const effectiveQuery = searchQuery.includes('å»ºæ¡ˆ') ? searchQuery : `å°ç£å»ºæ¡ˆ ${searchQuery}`;

                const userPrompt = `
                ${isGenericMode ? 'ç›®æ¨™ï¼šæ’°å¯«é€šç”¨æˆ¿åœ°ç”¢è©•è«–ï¼ˆä¸æŒ‡å®šå»ºæ¡ˆï¼‰' : `ç›®æ¨™å»ºæ¡ˆï¼š${effectiveQuery}`}
                å»ºæ¡ˆéšæ®µï¼š${projectStatus}
                ä½¿ç”¨è€…æƒ³å¼·èª¿çš„è³£é»ï¼š${features}
                è«‹ç”Ÿæˆ 5 å‰‡ç¹é«”ä¸­æ–‡è©•è«–ã€‚`;

                try {
                let response;
                let modeUsed = 'safe';

                if (isGenericMode) {
                    modeUsed = 'generic';
                    response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                        contents: [{ parts: [{ text: userPrompt }] }],
                        systemInstruction: { parts: [{ text: genericSystemPrompt }] },
                        generationConfig: { responseMimeType: "application/json" }
                        }),
                    }
                    );
                } else {
                    if (searchQuery.trim()) {
                    try {
                        response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                            contents: [{ parts: [{ text: userPrompt }] }],
                            systemInstruction: { parts: [{ text: searchSystemPrompt }] },
                            tools: [{ google_search: {} }]
                            }),
                        }
                        );
                        if (response.ok) {
                        modeUsed = 'search';
                        } else {
                        response = null; 
                        }
                    } catch (e) {
                        response = null;
                    }
                    }

                    if (!response || !response.ok) {
                    console.log("Entering Safe Mode...");
                    modeUsed = 'safe';
                    response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                        {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userPrompt }] }],
                            systemInstruction: { parts: [{ text: safeSystemPrompt }] },
                            generationConfig: { responseMimeType: "application/json" }
                        }),
                        }
                    );
                    }
                }

                if (!response.ok) throw new Error(`API è«‹æ±‚å¤±æ•— (${response.status})`);

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (text) {
                    const cleanText = cleanJson(text);
                    try {
                    const parsedReviews = JSON.parse(cleanText);
                    setReviews(parsedReviews);
                    setGenerationMode(modeUsed);
                    } catch (parseError) {
                    throw new Error("AI å›å‚³æ ¼å¼ç•°å¸¸ï¼Œè«‹å†è©¦ä¸€æ¬¡");
                    }
                } else {
                    throw new Error('AI å›å‚³å…§å®¹ç‚ºç©º');
                }

                } catch (err) {
                setError(err.message || 'ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤');
                console.error("Generate error:", err);
                } finally {
                setIsGenerating(false);
                }
            };

            const copyToClipboard = (text, index) => {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                document.execCommand('copy');
                setCopyStatus(index);
                setTimeout(() => setCopyStatus(null), 2000);
                } catch (err) {
                console.error('Copy failed', err);
                }
                document.body.removeChild(textArea);
            };

            return (
                <div className="min-h-screen bg-slate-50 text-slate-800 font-sans selection:bg-blue-100 pb-12">
                
                {/* é ‚éƒ¨æ¨™é¡Œå€ */}
                <div className="bg-white border-b border-slate-200 sticky top-0 z-20 shadow-sm">
                    <div className="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
                    <div className="flex items-center gap-3">
                        <div className="bg-gradient-to-br from-blue-600 to-indigo-600 p-2 rounded-lg text-white shadow-md flex-shrink-0">
                        <Home className="w-6 h-6" />
                        </div>
                        <div>
                        <h1 className="text-lg md:text-xl font-bold text-slate-900 leading-none">æˆ¿åœ°ç”¢å£ç¢‘ç”Ÿæˆå™¨</h1>
                        <p className="text-xs text-slate-500 mt-1 hidden md:block">AI è‡ªå‹•æœå°‹å»ºæ¡ˆè³‡è¨Š + æ“¬çœŸå¥½è©•åŠ©æ‰‹</p>
                        </div>
                    </div>
                    </div>
                </div>

                <div className="max-w-6xl mx-auto p-4 md:p-6 grid lg:grid-cols-12 gap-6 md:gap-8 mt-2">
                    
                    {/* å·¦å´ï¼šè¨­å®šå€ */}
                    <div className="lg:col-span-5 space-y-6">

                    {/* Step 1: æœå°‹/ç¶²å€ */}
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                        <div className="p-4 border-b border-slate-100 bg-slate-50/50 flex items-center gap-2">
                        <span className="flex items-center justify-center w-6 h-6 rounded-full bg-blue-600 text-white text-xs font-bold">1</span>
                        <h2 className="text-base font-bold text-slate-800">å»ºæ¡ˆè¨­å®š</h2>
                        {isGenericMode ? (
                            <span className="text-xs text-amber-600 bg-amber-50 px-2 py-0.5 rounded border border-amber-100 ml-auto font-medium">é€šç”¨æ¨¡å¼</span>
                        ) : (
                            <span className="text-xs text-blue-600 bg-blue-50 px-2 py-0.5 rounded border border-blue-100 ml-auto font-medium">AI æœå°‹æ¨¡å¼</span>
                        )}
                        </div>
                        <div className="p-4">
                        <div className="mb-3 flex items-center">
                            <input
                            type="checkbox"
                            id="genericMode"
                            checked={isGenericMode}
                            onChange={(e) => {
                                setIsGenericMode(e.target.checked);
                                if (e.target.checked) setSearchQuery('');
                            }}
                            className="w-4 h-4 text-blue-600 rounded border-slate-300 focus:ring-blue-500"
                            />
                            <label htmlFor="genericMode" className="ml-2 text-sm text-slate-700 font-medium cursor-pointer">
                            æˆ‘ä¸æŒ‡å®šç‰¹å®šå»ºæ¡ˆ (å•Ÿç”¨é€šç”¨æ¨¡å¼)
                            </label>
                        </div>

                        <div className={`relative transition-all duration-300 ${isGenericMode ? 'opacity-50 grayscale' : ''}`}>
                            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <Globe className="h-5 w-5 text-slate-400" />
                            </div>
                            <input
                            type="text"
                            value={searchQuery}
                            onChange={(e) => setSearchQuery(e.target.value)}
                            disabled={isGenericMode}
                            placeholder={isGenericMode ? "é€šç”¨æ¨¡å¼ä¸‹ç„¡éœ€è¼¸å…¥å»ºæ¡ˆåç¨±" : "ä¾‹å¦‚ï¼šä¿¡ç¾©å€æŸæŸå»ºæ¡ˆã€æˆ–è²¼ä¸Šå®˜ç¶²é€£çµ"}
                            className="w-full pl-10 pr-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-base bg-slate-50 disabled:bg-slate-100 disabled:cursor-not-allowed"
                            />
                        </div>
                        
                        {/* å»ºæ¡ˆéšæ®µé¸æ“‡ */}
                        <div className="mt-4 pt-4 border-t border-slate-100">
                            <label className="text-sm font-semibold text-slate-700 mb-2 flex items-center gap-1">
                            <HardHat className="w-4 h-4 text-blue-500" />
                            å»ºæ¡ˆéšæ®µ
                            </label>
                            <div className="grid grid-cols-3 gap-2">
                            {statusOptions.map((status) => (
                                <button
                                key={status.id}
                                onClick={() => setProjectStatus(status.id)}
                                className={`flex flex-col items-center justify-center p-2 rounded-lg border text-sm transition-all
                                    ${projectStatus === status.id
                                    ? 'bg-blue-50 border-blue-500 text-blue-700 font-bold shadow-sm'
                                    : 'bg-white border-slate-200 text-slate-600 hover:border-blue-300'
                                    }`}
                                >
                                <span>{status.label}</span>
                                </button>
                            ))}
                            </div>
                            <p className="text-xs text-slate-500 mt-2 bg-slate-50 p-2 rounded">
                            ğŸ‘‰ {statusOptions.find(s => s.id === projectStatus)?.desc}
                            </p>
                        </div>
                        </div>
                    </div>
                    
                    {/* Step 2: ç‰¹è‰²èˆ‡å„ªå‹¢ */}
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex flex-col lg:h-auto">
                        <div className="p-4 border-b border-slate-100 bg-slate-50/50 flex items-center justify-between flex-shrink-0">
                        <h2 className="text-base font-bold text-slate-800 flex items-center gap-2">
                            <span className="flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 text-blue-600 text-xs font-bold">2</span>
                            è£œå……ç‰¹è‰²
                        </h2>
                        <span className="text-xs text-slate-400 bg-white px-2 py-1 rounded border border-slate-200">é¸å¡«</span>
                        </div>
                        
                        <div className="p-4 flex flex-col">
                        <textarea
                            value={features}
                            onChange={(e) => setFeatures(e.target.value)}
                            placeholder="é™¤äº†æœå°‹åˆ°çš„è³‡è¨Šï¼Œæ‚¨é‚„æƒ³å¼·èª¿ä»€éº¼ï¼Ÿ(é»é¸ä¸‹æ–¹æ¨™ç±¤)"
                            className="w-full px-4 py-3 border border-slate-200 rounded-xl h-24 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all resize-none text-base bg-slate-50 mb-4 flex-shrink-0"
                        />
                        
                        <div className="flex gap-2 overflow-x-auto pb-2 mb-2 no-scrollbar flex-shrink-0">
                            {tagCategories.map((cat) => (
                            <button
                                key={cat.name}
                                onClick={() => setActiveCategory(cat.name)}
                                className={`whitespace-nowrap px-3 py-1.5 rounded-full text-xs font-medium transition-all
                                ${activeCategory === cat.name 
                                    ? 'bg-blue-600 text-white shadow-md shadow-blue-200' 
                                    : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}
                            >
                                {cat.name}
                            </button>
                            ))}
                        </div>

                        <div className="max-h-48 overflow-y-auto custom-scrollbar p-1">
                            <div className="flex flex-wrap gap-2 content-start">
                            {tagCategories.find(c => c.name === activeCategory)?.tags.map((tag) => (
                                <button
                                key={tag}
                                onClick={() => addTag(tag)}
                                className="px-3 py-2 bg-white text-slate-600 hover:text-blue-700 hover:border-blue-300 text-sm rounded-lg transition-all border border-slate-200 shadow-sm active:scale-95 text-left flex items-center gap-1 group"
                                >
                                <span className="w-1.5 h-1.5 rounded-full bg-slate-300 group-hover:bg-blue-500 flex-shrink-0"></span>
                                {tag}
                                </button>
                            ))}
                            </div>
                        </div>
                        </div>
                    </div>

                    {/* Step 3: è§’è‰²è¨­å®š */}
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200">
                        <div className="p-4 border-b border-slate-100 bg-slate-50/50">
                        <h2 className="text-base font-bold text-slate-800 flex items-center gap-2">
                            <span className="flex items-center justify-center w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 text-xs font-bold">3</span>
                            æŒ‡å®šè©•è«–è§’è‰²
                            <span className="text-xs font-normal text-slate-400 ml-auto">å¯è¤‡é¸</span>
                        </h2>
                        </div>
                        <div className="p-4 flex flex-wrap gap-2">
                        {rolesList.map((role) => {
                            const isSelected = selectedRoles.includes(role);
                            return (
                            <button
                                key={role}
                                onClick={() => toggleRole(role)}
                                className={`px-3 py-1.5 text-xs font-medium rounded-full transition-all border
                                ${isSelected 
                                    ? 'bg-indigo-600 text-white border-indigo-600 shadow-md shadow-indigo-200' 
                                    : 'bg-white text-slate-600 border-slate-200 hover:border-indigo-300 hover:text-indigo-600'
                                }`}
                            >
                                {role}
                            </button>
                            );
                        })}
                        </div>
                    </div>

                    {error && (
                        <div className="p-3 bg-red-50 text-red-600 text-sm rounded-xl border border-red-100 flex items-start gap-2 animate-fade-in">
                        <AlertCircle className="w-5 h-5 flex-shrink-0" />
                        {error}
                        </div>
                    )}

                    <button
                        onClick={generateReviews}
                        disabled={isGenerating}
                        className={`w-full py-4 px-6 rounded-xl text-white font-bold text-lg flex items-center justify-center gap-3 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5
                        ${isGenerating 
                            ? 'bg-slate-400 cursor-not-allowed shadow-none translate-y-0' 
                            : 'bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700'
                        }`}
                    >
                        {isGenerating ? (
                        <>
                            <Loader2 className="w-6 h-6 animate-spin" />
                            æ­£åœ¨ç”Ÿæˆ...
                        </>
                        ) : (
                        <>
                            <Sparkles className="w-6 h-6" />
                            AI ç”Ÿæˆå¥½è©•
                        </>
                        )}
                    </button>
                    </div>

                    {/* å³å´ï¼šçµæœå±•ç¤ºå€ */}
                    <div className="lg:col-span-7 flex flex-col h-full">
                    {/* Header å€åŸŸ */}
                    <div className="flex flex-wrap items-center justify-between mb-4 gap-2">
                        <div className="flex items-center gap-2">
                        <h2 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                            ç”Ÿæˆçµæœ
                            {reviews.length > 0 && (
                            <span className="text-xs font-medium text-blue-600 bg-blue-50 px-2 py-1 rounded-full border border-blue-100">
                                {reviews.length} å‰‡
                            </span>
                            )}
                        </h2>
                        </div>

                        <div className="flex items-center gap-2">
                        {/* ç‹€æ…‹æŒ‡ç¤ºæ¨™ç±¤ */}
                        {generationMode === 'search' && (
                            <span className="hidden md:flex items-center gap-1 text-xs font-bold text-emerald-600 bg-emerald-50 px-3 py-1 rounded-full border border-emerald-100 animate-fade-in">
                            <ShieldCheck className="w-3.5 h-3.5" />
                            Google è³‡æ–™å¼•ç”¨
                            </span>
                        )}
                        {generationMode === 'safe' && (
                            <span className="hidden md:flex items-center gap-1 text-xs font-bold text-amber-600 bg-amber-50 px-3 py-1 rounded-full border border-amber-100 animate-fade-in">
                            <AlertTriangle className="w-3.5 h-3.5" />
                            å®‰å…¨æ¨¡å¼
                            </span>
                        )}
                        {generationMode === 'generic' && (
                            <span className="hidden md:flex items-center gap-1 text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full border border-blue-100 animate-fade-in">
                            <Globe className="w-3.5 h-3.5" />
                            é€šç”¨æ¨¡å¼
                            </span>
                        )}

                        {/* ä¸€éµå¥æª¢æŒ‰éˆ• (åªæœ‰åœ¨æœ‰è©•è«–æ™‚é¡¯ç¤º) */}
                        {reviews.length > 0 && (
                            <button
                            onClick={handleCritiqueAll}
                            disabled={isAnalyzingAll}
                            className={`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold transition-all shadow-sm border
                                ${isAnalyzingAll 
                                ? 'bg-slate-100 text-slate-400 cursor-not-allowed border-slate-200' 
                                : 'bg-white text-red-600 border-red-200 hover:bg-red-50 hover:border-red-300'
                                }`}
                            >
                            {isAnalyzingAll ? (
                                <>
                                <Loader2 className="w-3.5 h-3.5 animate-spin" />
                                å…¨é«”å¯©è¦–ä¸­...
                                </>
                            ) : (
                                <>
                                <Eye className="w-3.5 h-3.5" />
                                ä¸€éµå°ˆå®¶å¥æª¢
                                </>
                            )}
                            </button>
                        )}
                        </div>
                    </div>

                    <div className="flex-1 bg-slate-100 rounded-2xl p-1 overflow-hidden border border-slate-200 min-h-[500px]">
                        {reviews.length === 0 ? (
                        <div className="h-full flex flex-col items-center justify-center text-slate-400 p-8 text-center space-y-4">
                            <div className="w-20 h-20 bg-white rounded-full flex items-center justify-center shadow-sm mb-2">
                            <Sparkles className="w-10 h-10 text-blue-200" />
                            </div>
                            <div>
                            <h3 className="text-slate-600 font-medium text-lg">æº–å‚™ç”Ÿæˆ</h3>
                            <p className="text-sm mt-1 max-w-xs mx-auto">
                                1. è¨­å®šå»ºæ¡ˆ (æœå°‹/é€šç”¨æ¨¡å¼ + éšæ®µ)<br/>
                                2. è£œå……ç‰¹è‰²èˆ‡é¸æ“‡è§’è‰²<br/>
                                3. AI ç‚ºæ‚¨æ’°å¯«æ“¬çœŸå¥½è©•
                            </p>
                            </div>
                        </div>
                        ) : (
                        <div className="h-full overflow-y-auto custom-scrollbar p-4 space-y-4">
                            {reviews.map((review, idx) => (
                            <div 
                                key={idx} 
                                className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 hover:shadow-md transition-all group relative animate-slide-up"
                                style={{ animationDelay: `${idx * 100}ms` }}
                            >
                                {/* Header */}
                                <div className="flex justify-between items-start mb-4 border-b border-slate-50 pb-3">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-100 to-blue-100 flex items-center justify-center text-indigo-600 font-bold text-sm flex-shrink-0">
                                    {review.role[0]}
                                    </div>
                                    <div className="flex flex-col">
                                    <span className="text-sm font-bold text-slate-800 flex items-center gap-1">
                                        {review.role}
                                    </span>
                                    <div className="flex text-amber-400 gap-0.5 text-xs">
                                        {[...Array(review.stars)].map((_, i) => (
                                        <svg key={i} className="w-3.5 h-3.5 fill-current" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                        </svg>
                                        ))}
                                    </div>
                                    </div>
                                </div>
                                
                                <button
                                    onClick={() => copyToClipboard(review.content, idx)}
                                    className={`px-3 py-1.5 rounded-lg transition-all flex items-center gap-1.5 text-xs font-medium border flex-shrink-0
                                    ${copyStatus === idx 
                                        ? 'bg-emerald-50 text-emerald-600 border-emerald-200' 
                                        : 'bg-white text-slate-500 border-slate-200 hover:border-blue-300 hover:text-blue-600'
                                    }`}
                                >
                                    {copyStatus === idx ? (
                                    <>
                                        <CheckCircle className="w-3.5 h-3.5" />
                                        å·²è¤‡è£½
                                    </>
                                    ) : (
                                    <>
                                        <Copy className="w-3.5 h-3.5" />
                                        è¤‡è£½
                                    </>
                                    )}
                                </button>
                                </div>

                                {/* Content */}
                                <div className="relative mb-4">
                                <Quote className="absolute -top-1 -left-1 w-6 h-6 text-slate-100 rotate-180 -z-0" />
                                <div className="relative z-10 pl-2">
                                    {rewritingIndex === idx ? (
                                    <div className="flex items-center gap-2 text-slate-500 animate-pulse py-2">
                                        <Loader2 className="w-5 h-5 animate-spin" />
                                        <span className="text-sm">AI æ­£åœ¨é‡æ–°æ’°å¯«ä¸­...</span>
                                    </div>
                                    ) : (
                                    <p className="text-slate-700 leading-relaxed whitespace-pre-line text-sm md:text-base break-words">
                                        {review.content}
                                    </p>
                                    )}
                                </div>
                                </div>

                                {/* Critique Results (Experts Review) */}
                                {critiques[idx] && (
                                <div className="mb-4 bg-red-50 border border-red-100 rounded-lg p-3 text-sm animate-fade-in">
                                    <div className="flex items-center gap-2 mb-2 font-bold text-red-800">
                                    <Eye className="w-4 h-4" />
                                    å°ˆå®¶å¥æª¢å ±å‘Š
                                    </div>
                                    <div className="text-slate-700 whitespace-pre-line leading-relaxed">
                                    {critiques[idx]}
                                    </div>
                                </div>
                                )}
                                {/* Loading State for Critique */}
                                {(isAnalyzingAll && !critiques[idx]) || analyzingIndex === idx ? (
                                <div className="mb-4 bg-slate-50 border border-slate-100 rounded-lg p-3 text-sm animate-pulse flex items-center gap-2 text-slate-500">
                                    <Loader2 className="w-4 h-4 animate-spin" />
                                    å°ˆå®¶æ­£åœ¨å¯©è¦–æ­¤è©•è«–ä¸­...
                                </div>
                                ) : null}

                                {/* AI Actions Toolbar */}
                                <div className="flex flex-wrap gap-2 pt-3 border-t border-slate-50">
                                <button
                                    onClick={() => handleCritique(idx)}
                                    disabled={analyzingIndex !== null || isAnalyzingAll}
                                    className={`px-3 py-1.5 text-xs rounded-lg flex items-center gap-1.5 transition-colors disabled:opacity-50
                                    ${critiques[idx] 
                                        ? 'bg-amber-100 text-amber-800 hover:bg-amber-200'
                                        : 'bg-red-50 hover:bg-red-100 text-red-600'
                                    }`}
                                >
                                    {analyzingIndex === idx ? (
                                    <Loader2 className="w-3.5 h-3.5 animate-spin" />
                                    ) : (
                                    critiques[idx] ? <CheckCheck className="w-3.5 h-3.5" /> : <ThumbsDown className="w-3.5 h-3.5" />
                                    )}
                                    {critiques[idx] ? 'å·²å¯©è¦– (é»æ“Šé‡æ¸¬)' : 'å–®å‰‡å¥æª¢'}
                                </button>

                                <button
                                    onClick={() => handleRewrite(idx, 'shorter')}
                                    disabled={rewritingIndex !== null || isAnalyzingAll}
                                    className="px-3 py-1.5 bg-slate-50 hover:bg-slate-100 text-slate-600 text-xs rounded-lg flex items-center gap-1.5 transition-colors disabled:opacity-50 ml-auto"
                                >
                                    <Wand2 className="w-3.5 h-3.5" />
                                    è®Šç°¡çŸ­
                                </button>
                                <button
                                    onClick={() => handleRewrite(idx, 'casual')}
                                    disabled={rewritingIndex !== null || isAnalyzingAll}
                                    className="px-3 py-1.5 bg-slate-50 hover:bg-slate-100 text-slate-600 text-xs rounded-lg flex items-center gap-1.5 transition-colors disabled:opacity-50"
                                >
                                    <MessageSquare className="w-3.5 h-3.5" />
                                    æ›´ç”Ÿæ´»åŒ–
                                </button>
                                <button
                                    onClick={() => handleRewrite(idx, 'social')}
                                    disabled={rewritingIndex !== null || isAnalyzingAll}
                                    className="px-3 py-1.5 bg-indigo-50 hover:bg-indigo-100 text-indigo-600 text-xs rounded-lg flex items-center gap-1.5 transition-colors disabled:opacity-50"
                                >
                                    <Share2 className="w-3.5 h-3.5" />
                                    è½‰ç‚ºç¤¾ç¾¤è²¼æ–‡
                                </button>
                                </div>
                            </div>
                            ))}
                        </div>
                        )}
                    </div>
                    </div>
                </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<RealEstateReviewGen />);
    </script>
</body>
</html>